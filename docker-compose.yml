version: '3'
services:
        traefik:
                container_name: traefik
                restart: always
                image: traefik:v1.7-alpine
                command:
                        - "--api"
                        - "--entrypoints=Name:http Address::80 Redirect.EntryPoint:https"
                        - "--entrypoints=Name:https Address::443 TLS"
                        - "--defaultentrypoints=http,https"
                        - "--acme"
                        - "--acme.storage=acme.json"
                        - "--acme.entryPoint=https"
                        - "--acme.httpChallenge.entryPoint=http"
                        - "--acme.onHostRule=true"
                        - "--acme.onDemand=false"
                        - "--docker"
                        - "--docker.watch"
                volumes:
                        - /var/run/docker.sock:/var/run/docker.sock
                        - /srv/traefik/:/etc/traefik/           
                ports:
                        - "80:80"
                        - "443:443"
        front:
                container_name: front
                restart: always
                image: paubarranca/debian-apache-php:latest
                volumes:
                        - /srv/front/data:/var/www/httpdocs
                labels:
                        - "traefik.frontend.rule=Host:dev.zobalo.com"
                        - "traefik.enable=true"
                        - "traefik.port=80"
                        - "traefik.frontend.headers.STSSeconds=31536000"
                        - "traefik.frontend.headers.STSIncludeSubdomains=true"
                        - "traefik.frontend.headers.STSPreload=true"
        mysql:
                container_name: mysql
                restart: always
                image: mysql:5.7
                volumes:
                        - /srv/mysql/data:/var/lib/mysql
                environment:
                          MYSQL_ROOT_PASSWORD: sccG6Au8sGhHL
                          MYSQL_DATABASE: docker_test 
                          MYSQL_USER: docker-test
                          MYSQL_PASSWORD: sccG6Au8sGhHL
                labels:
                        - "traefik.enable=false"
        wordpress:
                container_name: wordpress
                restart: always
                depends_on:
                        - mysql
                image: wordpress:php7.3-apache
                labels:
                        - "traefik.frontend.rule=Host:zobalo.com,www.zobalo.com"
                        - "traefik.enable=true"
                        - "traefik.port=80"
                        - "traefik.frontend.headers.STSSeconds=31536000"
                        - "traefik.frontend.headers.STSIncludeSubdomains=true"
                        - "traefik.frontend.headers.STSPreload=true"
                volumes:
                        - /srv/wordpress/data:/var/www/html
                environment:
                          WORDPRESS_DB_HOST: mysql:3306
                          WORDPRESS_DB_USER: docker-test 
                          WORDPRESS_DB_PASSWORD: sccG6Au8sGhHL 
                          WORDPRESS_DB_NAME: docker_test
        redis:
                container_name: redis
                restart: always
                depends_on:
                        - front
                image: paubarranca/redis:v1
                ports:
                        - "6379:6379"
                labels:
                        - "traefik.enable=false"
